<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Mindfulness Player</title>
    <style>
        /* --- ESTILOS GERAIS (Seu c√≥digo) --- */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: #f0f2f5; 
            text-align: center; 
            padding: 15px; 
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100vh;
            box-sizing: border-box;
            overflow: hidden;
        }
        p { 
            color: #333; 
            font-weight: 600;
            margin: 0 0 10px 0;
        }
        button { 
            background: #764ba2; 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 5px; 
            font-size: 16px;
            transition: background-color 0.2s;
        }
        button:hover { 
            background: #667eea; 
        }
        .time-display {
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            color: #555;
            margin-top: 10px;
            background-color: #e9ecef;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }
        #songTitle {
            font-size: 14px;
            color: #444;
            margin-top: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        /* --- NOVO: CSS APRIMORADO PARA O CONTROLE DE VOLUME --- */
        .volume-control {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            gap: 10px;
        }

        #volumeIcon {
            font-size: 20px;
            cursor: pointer;
            user-select: none; /* Impede que o √≠cone seja selecionado como texto */
        }

        #volumeSlider {
            -webkit-appearance: none;
            appearance: none;
            width: 120px;
            height: 6px;
            background: #d3d3d3; /* Cor da trilha de fundo */
            border-radius: 5px;
            outline: none;
            cursor: pointer;
            transition: background 0.2s ease-in-out;
        }

        #volumeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #6a11cb; /* Cor roxa mais forte para a bolinha */
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 4px rgba(0,0,0,0.2);
            margin-top: -5px; /* Centraliza a bolinha verticalmente na trilha */
        }

        #volumeSlider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #6a11cb;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <p>Mindfulness Music Player</p>
    <audio id="background-audio"></audio>
    <div>
        <button id="playPauseBtn">‚ñ∂Ô∏è</button>
        <button id="skipBtn">‚è©</button>
    </div>

    <div class="time-display">
        <span id="currentTime">00:00</span> / <span id="totalDuration">00:00</span>
    </div>

    <div id="songTitle">Selecione uma m√∫sica</div>

    <!-- --- NOVO: HTML para o Controle de Volume --- -->
    <div class="volume-control">
        <span id="volumeIcon">üîä</span>
        <input type="range" id="volumeSlider" min="0" max="1" step="0.01">
    </div>
                <div class="header-actions">
                    <button id="resolverQuestoes" class="share-btn">
                        <span class="icon">üåê</span>
                        Continuar navegando
                    </button>
                </div>

    <script>
        // --- SEU C√ìDIGO JAVASCRIPT EXISTENTE ---
        const audioPlayer = document.getElementById('background-audio');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const skipBtn = document.getElementById('skipBtn');
        const currentTimeEl = document.getElementById('currentTime');
        const totalDurationEl = document.getElementById('totalDuration');
        const songTitleEl = document.getElementById('songTitle');
        
        // --- NOVO: Refer√™ncias para os elementos de volume ---
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeIcon = document.getElementById('volumeIcon');

        const musicPlaylist = [
            { src: 'music/trem-bala.mp3', title: 'Trem-Bala - Ana Vilela' },
            { src: 'music/mercy-me.mp3', title: 'I Can Only Imagine - MercyMe' }
        ];
        
        let currentTrackIndex = -1;
        const LAST_TRACK_KEY = 'mindfulness_last_track_index';
        // --- NOVO: Chave para salvar o volume no localStorage ---
        const LAST_VOLUME_KEY = 'mindfulness_last_volume';

        function getRandomTrackIndex(excludeIndex = -1) {
            let newIndex;
            if (musicPlaylist.length > 1) {
                do {
                    newIndex = Math.floor(Math.random() * musicPlaylist.length);
                } while (newIndex === excludeIndex);
            } else {
                newIndex = 0;
            }
            return newIndex;
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function playMusic() {
            if (currentTrackIndex < 0 || currentTrackIndex >= musicPlaylist.length) return;
            const track = musicPlaylist[currentTrackIndex];
            audioPlayer.src = track.src;
            songTitleEl.textContent = track.title;
            songTitleEl.title = track.title;
            localStorage.setItem(LAST_TRACK_KEY, currentTrackIndex);
            audioPlayer.play().catch(error => console.error("Autoplay no pop-up falhou:", error));
        }

        function skipMusic() {
            currentTrackIndex = getRandomTrackIndex(currentTrackIndex);
            playMusic();
        }

        // --- NOVA FUN√á√ÉO: Atualiza o √≠cone de volume (Mudo, Baixo, Alto) ---
        function updateVolumeIcon() {
            if (audioPlayer.volume === 0) {
                volumeIcon.textContent = 'üîá';
            } else if (audioPlayer.volume < 0.5) {
                volumeIcon.textContent = 'üîâ';
            } else {
                volumeIcon.textContent = 'üîä';
            }
        }

        // --- NOVA FUN√á√ÉO: Atualiza o fundo do slider para mostrar o progresso ---
        function updateSliderBackground() {
            const progress = (volumeSlider.value / volumeSlider.max) * 100;
            volumeSlider.style.background = `linear-gradient(to right, #8e2de2 ${progress}%, #d3d3d3 ${progress}%)`;
        }

        playPauseBtn.addEventListener('click', () => {
            if (audioPlayer.paused) {
                if (!audioPlayer.src) {
                    const lastPlayedIndex = parseInt(localStorage.getItem(LAST_TRACK_KEY), 10);
                    currentTrackIndex = getRandomTrackIndex(lastPlayedIndex);
                    playMusic();
                } else {
                    audioPlayer.play();
                }
            } else {
                audioPlayer.pause();
            }
        });
        
        audioPlayer.addEventListener('play', () => { playPauseBtn.textContent = '‚è∏Ô∏è'; });
        audioPlayer.addEventListener('pause', () => { playPauseBtn.textContent = '‚ñ∂Ô∏è'; });

        skipBtn.addEventListener('click', skipMusic);
        audioPlayer.addEventListener('ended', skipMusic);

        audioPlayer.addEventListener('timeupdate', () => {
            currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
        });

        audioPlayer.addEventListener('loadedmetadata', () => {
            totalDurationEl.textContent = formatTime(audioPlayer.duration);
        });

        // --- NOVO: Event listener para o slider de volume ---
        volumeSlider.addEventListener('input', (e) => {
            const newVolume = e.target.value;
            audioPlayer.volume = newVolume;
            localStorage.setItem(LAST_VOLUME_KEY, newVolume);
            updateVolumeIcon();
            updateSliderBackground();
        });

        // --- NOVO: Event listener para o √≠cone de volume (mutar/desmutar) ---
        volumeIcon.addEventListener('click', () => {
            if (audioPlayer.volume > 0) {
                volumeSlider.setAttribute('data-last-volume', audioPlayer.volume);
                audioPlayer.volume = 0;
                volumeSlider.value = 0;
            } else {
                const lastVolume = volumeSlider.getAttribute('data-last-volume') || 0.5;
                audioPlayer.volume = lastVolume;
                volumeSlider.value = lastVolume;
            }
            updateVolumeIcon();
            updateSliderBackground();
        });

      // Dentro da tag <script> de player.html

// L√≥gica de inicializa√ß√£o do player
document.addEventListener('DOMContentLoaded', () => {
    // Carrega o √∫ltimo volume salvo ou define um padr√£o
    const savedVolume = localStorage.getItem('mindfulness_last_volume') || 0.5;
    audioPlayer.volume = savedVolume;
    volumeSlider.value = savedVolume;
    updateVolumeIcon();
    updateSliderBackground();

    // --- ESTA PARTE √â ESSENCIAL ---
    // Pega os par√¢metros da URL para decidir se deve tocar automaticamente
    const urlParams = new URLSearchParams(window.location.search);
    const shouldAutoplay = urlParams.get('autoplay') === 'true';

    if (shouldAutoplay) {
        // Se o autoplay for solicitado, inicia a m√∫sica
        const lastPlayedIndex = parseInt(localStorage.getItem('mindfulness_last_track_index'), 10);
        currentTrackIndex = isNaN(lastPlayedIndex) ? getRandomTrackIndex() : getRandomTrackIndex(lastPlayedIndex);
        playMusic();
    }
});



    </script>
</body>
</html>
